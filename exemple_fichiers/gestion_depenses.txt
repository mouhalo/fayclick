# ğŸ¯ PROMPT : ImplÃ©mentation du Module de Gestion des DÃ©penses

## CONTEXTE
Tu es un expert dÃ©veloppeur Next.js/React spÃ©cialisÃ© dans FayClick V2. Tu dois crÃ©er un module complet de gestion des dÃ©penses pour une structure, incluant la gestion des types de dÃ©penses, avec toutes les opÃ©rations CRUD (Create, Read, Update, Delete).

---

## ğŸ“‹ FONCTIONS SQL DISPONIBLES

### 1. RÃ©cupÃ©ration des DÃ©penses
```sql
-- Fonction : get_list_depenses
SELECT * FROM get_list_depenses(pid_structure, pannee, pperiode);
-- ParamÃ¨tres :
-- - pid_structure : INTEGER (requis)
-- - pannee : INTEGER (dÃ©faut = annÃ©e en cours)
-- - pperiode : VARCHAR ('mois', 'trimestre', 'annee') (dÃ©faut = 'annee')
```

**RÃ©ponse JSON :**
```json
{
  "success": true,
  "structure_id": 139,
  "periode": "annee",
  "annee": 2025,
  "date_debut": "2025-01-01",
  "date_fin": "2025-12-31",
  "resume_depenses": {
    "total_depenses": 725000,
    "variation_depenses": 12.5,
    "nb_depenses": 15,
    "variation_nb_depenses": -25.0,
    "depense_moyenne": 48333,
    "nb_types_utilises": 3,
    "nb_types_total": 4,
    "montant_min": 5000,
    "montant_max": 550000,
    "date_premiere_depense": "2025-03-21",
    "date_derniere_depense": "2025-09-21"
  },
  "depenses_par_type": [
    {
      "id_type_depense": 4,
      "nom_type": "SALAIRE",
      "total_depenses": 550000,
      "nb_depenses": 3,
      "pourcentage_total": 75.9,
      "depense_moyenne": 183333,
      "montant_min": 150000,
      "montant_max": 250000,
      "derniere_depense": "2025-08-21"
    }
  ],
  "liste_depenses": [
    {
      "id_depense": 1,
      "date_depense": "2025-09-21",
      "id_type_depense": 2,
      "nom_type": "EQUIPEMENTS",
      "montant": 25000,
      "description": "Achat matÃ©riel bureau",
      "tms_update": "2025-09-24T20:31:36.776",
      "mois": "September",
      "trimestre": "Q3",
      "jour_semaine": "Sunday"
    }
  ],
  "evolution_depenses": [...],
  "timestamp_generation": "2025-10-18T20:30:45.123Z"
}
```

### 2. Ajout/Modification d'une DÃ©pense
```sql
-- Fonction : add_edit_depense
SELECT * FROM add_edit_depense(
    pid_structure,      -- INTEGER : ID structure
    pdate,              -- DATE : Date de la dÃ©pense
    pid_type,           -- INTEGER : ID type de dÃ©pense
    pmontant,           -- NUMERIC : Montant (doit Ãªtre positif)
    pdescription,       -- VARCHAR : Description
    pid_depense         -- INTEGER : 0 pour crÃ©ation, >0 pour modification
);
```

**RÃ©ponse (format TABLE) :**
```json
{
  "result_id_depense": 1,
  "result_id_structure": 139,
  "result_date_depense": "2025-09-21",
  "result_id_type_depense": 2,
  "result_nom_type_depense": "EQUIPEMENTS",
  "result_montant": 25000,
  "result_description": "Achat matÃ©riel bureau",
  "result_tms_update": "2025-09-24T20:31:36.776",
  "result_action_effectuee": "CREATION" // ou "MODIFICATION"
}
```

### 3. Ajout/Modification d'un Type de DÃ©pense
```sql
-- Fonction : add_edit_type_depense
SELECT * FROM add_edit_type_depense(
    pid_structure,       -- INTEGER : ID structure
    pnom_type,          -- VARCHAR : Nom du type (max 120 caractÃ¨res)
    pid_type_depense    -- INTEGER : 0 pour crÃ©ation, >0 pour modification
);
```

**RÃ©ponse (format TABLE) :**
```json
{
  "result_id_type_depense": 1,
  "result_id_structure": 139,
  "result_nom_type": "FRAIS DE TRANSPORT",
  "result_action_effectuee": "CREATION", // ou "MODIFICATION"
  "result_nb_depenses_associees": 5
}
```

### 4. Suppression d'une DÃ©pense
```sql
-- Fonction : delete_depense
SELECT * FROM delete_depense(pid_structure, pid_depense);
```

**RÃ©ponse JSON :**
```json
{
  "success": true,
  "message": "DÃ©pense supprimÃ©e avec succÃ¨s",
  "depense_supprimee": {
    "id_depense": 1,
    "date_depense": "2025-09-21",
    "nom_type": "EQUIPEMENTS",
    "montant": 25000,
    "description": "Achat matÃ©riel bureau"
  },
  "timestamp": "2025-10-18T20:45:23.456Z"
}
```

### 5. Suppression d'un Type de DÃ©pense
```sql
-- Fonction : delete_type_depense
SELECT * FROM delete_type_depense(pid_structure, pid_type);
```

**RÃ©ponse JSON (succÃ¨s) :**
```json
{
  "success": true,
  "message": "Type de dÃ©pense supprimÃ© avec succÃ¨s",
  "type_supprime": {
    "id_type_depense": 1,
    "nom_type": "FRAIS DE TRANSPORT"
  },
  "timestamp": "2025-10-18T20:46:15.789Z"
}
```

**RÃ©ponse JSON (Ã©chec - dÃ©penses liÃ©es) :**
```json
{
  "success": false,
  "error": "Impossible de supprimer ce type de dÃ©pense car 5 dÃ©pense(s) y sont associÃ©e(s)",
  "nb_depenses_liees": 5,
  "nom_type": "SALAIRE",
  "suggestion": "Veuillez d'abord supprimer ou rÃ©affecter les dÃ©penses associÃ©es"
}
```

---

## ğŸ¨ STRUCTURE DE L'INTERFACE

### Layout de la Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† [Back]          [Logo]                               â”‚
â”‚                 Gestion des DÃ©penses                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š StatCards (2x1)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Nombre: 15           â”‚  â”‚ Type le + coÃ»teux      â”‚ â”‚
â”‚  â”‚ Total: 725,000 FCFA  â”‚  â”‚ SALAIRE: 550,000 FCFA  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Barre de Recherche (3x1)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [ğŸ”½] [â†»]                         â”‚
â”‚  â”‚ Rechercher...    â”‚  Filtre Refresh                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“„ Pagination                                           â”‚
â”‚  Â« PrÃ©cÃ©dent | Page 1 de 2 | Suivant Â»                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Liste des DÃ©penses (Cartes)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“… 21/09/2025        EQUIPEMENTS          [âœï¸] [ğŸ—‘ï¸]â”‚ â”‚
â”‚  â”‚ Achat matÃ©riel bureau                             â”‚ â”‚
â”‚  â”‚ ğŸ’° 25,000 FCFA                                    â”‚ â”‚
â”‚  â”‚ Mis Ã  jour: 24/09/2025 20:31                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“… 21/08/2025        SALAIRE              [âœï¸] [ğŸ—‘ï¸]â”‚ â”‚
â”‚  â”‚ Salaire Gardien                                   â”‚ â”‚
â”‚  â”‚ ğŸ’° 550,000 FCFA                                   â”‚ â”‚
â”‚  â”‚ Mis Ã  jour: 24/09/2025 20:33                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+ Nouvelle DÃ©pense]  [âš™ï¸ GÃ©rer les Types]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ARCHITECTURE DES FICHIERS

```
app/
â”œâ”€â”€ dashboard/
â”‚   â””â”€â”€ depenses/
â”‚       â””â”€â”€ page.tsx                    # Page principale

components/
â”œâ”€â”€ depenses/
â”‚   â”œâ”€â”€ DepensesHeader.tsx             # Header avec back + logo
â”‚   â”œâ”€â”€ DepensesStatCards.tsx          # 2 StatCards (Nombre/Total, Type +coÃ»teux)
â”‚   â”œâ”€â”€ DepensesSearchBar.tsx          # Barre de recherche + filtres
â”‚   â”œâ”€â”€ DepensesPagination.tsx         # Pagination
â”‚   â”œâ”€â”€ DepenseCard.tsx                # Carte individuelle de dÃ©pense
â”‚   â”œâ”€â”€ DepensesList.tsx               # Liste des cartes
â”‚   â”œâ”€â”€ AddEditDepenseModal.tsx        # Modal ajout/Ã©dition dÃ©pense
â”‚   â”œâ”€â”€ DeleteDepenseModal.tsx         # Modal confirmation suppression
â”‚   â”œâ”€â”€ GererTypesModal.tsx            # Modal gestion des types
â”‚   â””â”€â”€ FiltresDepensesModal.tsx       # Modal filtres multicritÃ¨res

services/
â””â”€â”€ depense.service.ts                 # Service de communication API

types/
â””â”€â”€ depense.types.ts                   # Types TypeScript

hooks/
â””â”€â”€ useDepenses.ts                     # Hook personnalisÃ© (optionnel)
```

---

## ğŸ“ TYPES TYPESCRIPT OBLIGATOIRES

```typescript
// types/depense.types.ts

export interface Depense {
  id_depense: number;
  date_depense: string;
  id_type_depense: number;
  nom_type: string;
  montant: number;
  description: string;
  tms_update: string;
  mois?: string;
  trimestre?: string;
  jour_semaine?: string;
}

export interface TypeDepense {
  id_type_depense: number;
  nom_type: string;
  total_depenses: number;
  nb_depenses: number;
  pourcentage_total: number;
  depense_moyenne: number;
  montant_min: number;
  montant_max: number;
  derniere_depense: string | null;
}

export interface ResumeDepenses {
  total_depenses: number;
  variation_depenses: number;
  nb_depenses: number;
  variation_nb_depenses: number;
  depense_moyenne: number;
  nb_types_utilises: number;
  nb_types_total: number;
  montant_min: number;
  montant_max: number;
  date_premiere_depense: string | null;
  date_derniere_depense: string | null;
}

export interface DepensesData {
  success: boolean;
  structure_id: number;
  periode: string;
  annee: number;
  date_debut: string;
  date_fin: string;
  resume_depenses: ResumeDepenses;
  depenses_par_type: TypeDepense[];
  liste_depenses: Depense[];
  evolution_depenses: any[];
  timestamp_generation: string;
}

export interface DepenseFormData {
  date_depense: string;
  id_type_depense: number;
  montant: number;
  description: string;
}

export interface FiltresDepenses {
  recherche?: string;
  type_depense?: number;
  date_debut?: string;
  date_fin?: string;
  montant_min?: number;
  montant_max?: number;
}
```

---

## ğŸ”§ SERVICE DE COMMUNICATION

```typescript
// services/depense.service.ts
import { DatabaseService } from './database.service';
import { extractSingleDataFromResult, extractDataFromResults } from '@/utils/dataExtractor';
import type { DepensesData, DepenseFormData } from '@/types/depense.types';

export class DepenseService {
  private databaseService: DatabaseService;

  constructor() {
    this.databaseService = new DatabaseService();
  }

  // 1. RÃ‰CUPÃ‰RER LA LISTE DES DÃ‰PENSES
  async getListeDepenses(
    structureId: number,
    annee: number,
    periode: string = 'annee'
  ): Promise<DepensesData> {
    try {
      const requeteSql = `SELECT * FROM get_list_depenses(${structureId}, ${annee}, '${periode}')`;
      
      const result = await this.databaseService.envoyerRequeteApi('payecole', requeteSql);

      if (!result || result.length === 0) {
        throw new Error('Aucune donnÃ©e retournÃ©e');
      }

      const data = extractSingleDataFromResult<DepensesData>(result[0]);
      
      if (!data.success) {
        throw new Error(data.error || 'Erreur lors de la rÃ©cupÃ©ration des dÃ©penses');
      }

      return data;
    } catch (error) {
      console.error('[DepenseService] getListeDepenses:', error);
      throw error;
    }
  }

  // 2. AJOUTER UNE DÃ‰PENSE
  async ajouterDepense(
    structureId: number,
    formData: DepenseFormData
  ): Promise<any> {
    try {
      const requeteSql = `
        SELECT * FROM add_edit_depense(
          ${structureId},
          '${formData.date_depense}'::date,
          ${formData.id_type_depense},
          ${formData.montant},
          '${formData.description.replace(/'/g, "''")}',
          0
        )
      `;
      
      const result = await this.databaseService.envoyerRequeteApi('payecole', requeteSql);

      if (!result || result.length === 0) {
        throw new Error('Ã‰chec de l\'ajout de la dÃ©pense');
      }

      return extractSingleDataFromResult(result[0]);
    } catch (error) {
      console.error('[DepenseService] ajouterDepense:', error);
      throw error;
    }
  }

  // 3. MODIFIER UNE DÃ‰PENSE
  async modifierDepense(
    structureId: number,
    depenseId: number,
    formData: DepenseFormData
  ): Promise<any> {
    try {
      const requeteSql = `
        SELECT * FROM add_edit_depense(
          ${structureId},
          '${formData.date_depense}'::date,
          ${formData.id_type_depense},
          ${formData.montant},
          '${formData.description.replace(/'/g, "''")}',
          ${depenseId}
        )
      `;
      
      const result = await this.databaseService.envoyerRequeteApi('payecole', requeteSql);

      if (!result || result.length === 0) {
        throw new Error('Ã‰chec de la modification de la dÃ©pense');
      }

      return extractSingleDataFromResult(result[0]);
    } catch (error) {
      console.error('[DepenseService] modifierDepense:', error);
      throw error;
    }
  }

  // 4. SUPPRIMER UNE DÃ‰PENSE
  async supprimerDepense(
    structureId: number,
    depenseId: number
  ): Promise<any> {
    try {
      const requeteSql = `SELECT * FROM delete_depense(${structureId}, ${depenseId})`;
      
      const result = await this.databaseService.envoyerRequeteApi('payecole', requeteSql);

      if (!result || result.length === 0) {
        throw new Error('Ã‰chec de la suppression');
      }

      const data = extractSingleDataFromResult(result[0]);
      
      if (!data.success) {
        throw new Error(data.error || 'Erreur lors de la suppression');
      }

      return data;
    } catch (error) {
      console.error('[DepenseService] supprimerDepense:', error);
      throw error;
    }
  }

  // 5. AJOUTER/MODIFIER UN TYPE DE DÃ‰PENSE
  async ajouterOuModifierType(
    structureId: number,
    nomType: string,
    typeId: number = 0
  ): Promise<any> {
    try {
      const requeteSql = `
        SELECT * FROM add_edit_type_depense(
          ${structureId},
          '${nomType.replace(/'/g, "''")}',
          ${typeId}
        )
      `;
      
      const result = await this.databaseService.envoyerRequeteApi('payecole', requeteSql);

      if (!result || result.length === 0) {
        throw new Error('Ã‰chec de l\'opÃ©ration sur le type');
      }

      return extractSingleDataFromResult(result[0]);
    } catch (error) {
      console.error('[DepenseService] ajouterOuModifierType:', error);
      throw error;
    }
  }

  // 6. SUPPRIMER UN TYPE DE DÃ‰PENSE
  async supprimerType(
    structureId: number,
    typeId: number
  ): Promise<any> {
    try {
      const requeteSql = `SELECT * FROM delete_type_depense(${structureId}, ${typeId})`;
      
      const result = await this.databaseService.envoyerRequeteApi('payecole', requeteSql);

      if (!result || result.length === 0) {
        throw new Error('Ã‰chec de la suppression du type');
      }

      const data = extractSingleDataFromResult(result[0]);
      
      if (!data.success) {
        throw new Error(data.error || 'Erreur lors de la suppression du type');
      }

      return data;
    } catch (error) {
      console.error('[DepenseService] supprimerType:', error);
      throw error;
    }
  }
}
```

---

## ğŸ¨ COMPOSANTS UI PRINCIPAUX

### 1. Header

```tsx
// components/depenses/DepensesHeader.tsx
import { ArrowLeft } from 'lucide-react';
import { useRouter } from 'next/navigation';

export default function DepensesHeader() {
  const router = useRouter();

  return (
    <div className="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 shadow-md">
      <div className="flex items-center justify-between mb-4">
        <button 
          onClick={() => router.push('/dashboard')}
          className="text-white hover:bg-white/20 p-2 rounded-lg transition"
        >
          <ArrowLeft size={24} />
        </button>
        <div className="text-white">
          {/* Logo centrÃ© */}
          <div className="text-2xl font-bold">FayClick</div>
        </div>
        <div className="w-10" /> {/* Espaceur pour centrer le logo */}
      </div>
      <h1 className="text-2xl font-bold text-white text-center">
        Gestion des DÃ©penses
      </h1>
    </div>
  );
}
```

### 2. StatCards

```tsx
// components/depenses/DepensesStatCards.tsx
import { TrendingUp, DollarSign } from 'lucide-react';
import type { ResumeDepenses, TypeDepense } from '@/types/depense.types';

interface DepensesStatCardsProps {
  resume: ResumeDepenses;
  typesDepenses: TypeDepense[];
}

export default function DepensesStatCards({ resume, typesDepenses }: DepensesStatCardsProps) {
  // Trouver le type le plus coÃ»teux
  const typePlusCouteux = typesDepenses.length > 0 
    ? typesDepenses.reduce((max, type) => 
        type.total_depenses > max.total_depenses ? type : max
      )
    : null;

  return (
    <div className="grid grid-cols-2 gap-4 p-4">
      {/* StatCard 1 : Nombre et Total */}
      <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
        <div className="flex items-center gap-2 mb-2">
          <DollarSign className="text-blue-600" size={20} />
          <span className="text-sm text-gray-600 font-medium">DÃ©penses</span>
        </div>
        <div className="space-y-1">
          <div>
            <div className="text-2xl font-bold text-gray-800">
              {resume.nb_depenses}
            </div>
            <div className="text-xs text-gray-500">Nombre de dÃ©penses</div>
          </div>
          <div className="pt-2 border-t">
            <div className="text-xl font-semibold text-blue-600">
              {resume.total_depenses.toLocaleString('fr-FR')} FCFA
            </div>
            <div className="text-xs text-gray-500">Total dÃ©pensÃ©</div>
          </div>
        </div>
      </div>

      {/* StatCard 2 : Type le plus coÃ»teux */}
      <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
        <div className="flex items-center gap-2 mb-2">
          <TrendingUp className="text-orange-600" size={20} />
          <span className="text-sm text-gray-600 font-medium">Type + coÃ»teux</span>
        </div>
        {typePlusCouteux ? (
          <div className="space-y-1">
            <div className="text-lg font-bold text-gray-800 truncate">
              {typePlusCouteux.nom_type}
            </div>
            <div className="text-xl font-semibold text-orange-600">
              {typePlusCouteux.total_depenses.toLocaleString('fr-FR')} FCFA
            </div>
            <div className="text-xs text-gray-500">
              {typePlusCouteux.nb_depenses} dÃ©pense(s) â€¢ {typePlusCouteux.pourcentage_total}%
            </div>
          </div>
        ) : (
          <div className="text-sm text-gray-400">Aucune dÃ©pense</div>
        )}
      </div>
    </div>
  );
}
```

### 3. Barre de Recherche

```tsx
// components/depenses/DepensesSearchBar.tsx
import { Search, Filter, RefreshCw } from 'lucide-react';
import { useState } from 'react';

interface DepensesSearchBarProps {
  onSearch: (query: string) => void;
  onOpenFilters: () => void;
  onRefresh: () => void;
  isLoading?: boolean;
}

export default function DepensesSearchBar({ 
  onSearch, 
  onOpenFilters, 
  onRefresh,
  isLoading = false 
}: DepensesSearchBarProps) {
  const [searchQuery, setSearchQuery] = useState('');

  const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value;
    setSearchQuery(value);
    onSearch(value);
  };

  return (
    <div className="p-4 bg-white shadow-sm">
      <div className="grid grid-cols-[1fr_auto_auto] gap-3 items-center">
        {/* Champ de recherche */}
        <div className="relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={20} />
          <input
            type="text"
            placeholder="Rechercher une dÃ©pense..."
            value={searchQuery}
            onChange={handleSearch}
            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>

        {/* Bouton Filtres */}
        <button
          onClick={onOpenFilters}
          className="p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
          title="Filtres avancÃ©s"
        >
          <Filter size={20} className="text-gray-600" />
        </button>

        {/* Bouton Actualiser */}
        <button
          onClick={onRefresh}
          disabled={isLoading}
          className="p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:opacity-50"
          title="Actualiser"
        >
          <RefreshCw 
            size={20} 
            className={`text-gray-600 ${isLoading ? 'animate-spin' : ''}`} 
          />
        </button>
      </div>
    </div>
  );
}
```

### 4. Carte de DÃ©pense

```tsx
// components/depenses/DepenseCard.tsx
import { Calendar, Edit, Trash2, Tag, Clock } from 'lucide-react';
import type { Depense } from '@/types/depense.types';

interface DepenseCardProps {
  depense: Depense;
  onEdit: (depense: Depense) => void;
  onDelete: (depense: Depense) => void;
}

export default function DepenseCard({ depense, onEdit, onDelete }: DepenseCardProps) {
  const formatDate = (dateStr: string) => {
    return new Date(dateStr).toLocaleDateString('fr-FR', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    });
  };

  const formatDateTime = (dateStr: string) => {
    return new Date(dateStr).toLocaleString('fr-FR', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  return (
    <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition">
      {/* Header : Date + Type + Actions */}
      <div className="flex items-start justify-between mb-3">
        <div className="flex-1">
          <div className="flex items-center gap-2 mb-1">
            <Calendar size={16} className="text-gray-400" />
            <span className="text-sm font-medium text-gray-700">
              {formatDate(depense.date_depense)}
            </span>
          </div>
          <div className="flex items-center gap-2">
            <Tag size={16} className="text-blue-600" />
            <span className="text-sm font-semibold text-blue-600">
              {depense.nom_type}
            </span>
          </div>
        </div>
        
        <div className="flex gap-2">
          <button
            onClick={() => onEdit(depense)}
            className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition"
            title="Modifier"
          >
            <Edit size={18} />
          </button>
          <button
            onClick={() => onDelete(depense)}
            className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition"
            title="Supprimer"
          >
            <Trash2 size={18} />
          </button>
        </div>
      </div>

      {/* Description */}
      <p className="text-sm text-gray-600 mb-3 line-clamp-2">
        {depense.description}
      </p>

      {/* Footer : Montant + Mise Ã  jour */}
      <div className="flex items-center justify-between pt-3 border-t border-gray-100">
        <div className="text-xl font-bold text-green-600">
          {depense.montant.toLocaleString('fr-FR')} FCFA
        </div>
        <div className="flex items-center gap-1 text-xs text-gray-400">
          <Clock size={12} />
          <span>{formatDateTime(depense.tms_update)}</span>
        </div>
      </div>
    </div>
  );
}
```

### 5. Modal Ajout/Ã‰dition de DÃ©pense

```tsx
// components/depenses/AddEditDepenseModal.tsx
'use client';

import { useState, useEffect } from 'react';
import { X } from 'lucide-react';
import type { Depense, TypeDepense, DepenseFormData } from '@/types/depense.types';

interface AddEditDepenseModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (data: DepenseFormData, depenseId?: number) => Promise<void>;
  depense?: Depense | null;
  typesDepenses: TypeDepense[];
}

export default function AddEditDepenseModal({
  isOpen,
  onClose,
  onSubmit,
  depense,
  typesDepenses
}: AddEditDepenseModalProps) {
  const [formData, setFormData] = useState<DepenseFormData>({
    date_depense: new Date().toISOString().split('T')[0],
    id_type_depense: 0,
    montant: 0,
    description: ''
  });
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Initialiser le formulaire en mode Ã©dition
  useEffect(() => {
    if (depense) {
      setFormData({
        date_depense: depense.date_depense,
        id_type_depense: depense.id_type_depense,
        montant: depense.montant,
        description: depense.description
      });
    } else {
      setFormData({
        date_depense: new Date().toISOString().split('T')[0],
        id_type_depense: typesDepenses[0]?.id_type_depense || 0,
        montant: 0,
        description: ''
      });
    }
    setError(null);
  }, [depense, typesDepenses, isOpen]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    // Validation
    if (!formData.date_depense) {
      setError('La date est requise');
      return;
    }
    if (formData.id_type_depense === 0) {
      setError('Veuillez sÃ©lectionner un type de dÃ©pense');
      return;
    }
    if (formData.montant <= 0) {
      setError('Le montant doit Ãªtre supÃ©rieur Ã  0');
      return;
    }

    try {
      setIsSubmitting(true);
      setError(null);
      await onSubmit(formData, depense?.id_depense);
      onClose();
    } catch (err: any) {
      setError(err.message || 'Erreur lors de l\'enregistrement');
    } finally {
      setIsSubmitting(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b">
          <h2 className="text-xl font-bold text-gray-800">
            {depense ? 'Modifier la dÃ©pense' : 'Nouvelle dÃ©pense'}
          </h2>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600 transition"
          >
            <X size={24} />
          </button>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} className="p-6 space-y-4">
          {error && (
            <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm">
              {error}
            </div>
          )}

          {/* Date */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Date de la dÃ©pense *
            </label>
            <input
              type="date"
              value={formData.date_depense}
              onChange={(e) => setFormData({ ...formData, date_depense: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              required
            />
          </div>

          {/* Type de dÃ©pense */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Type de dÃ©pense *
            </label>
            <select
              value={formData.id_type_depense}
              onChange={(e) => setFormData({ ...formData, id_type_depense: parseInt(e.target.value) })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              required
            >
              <option value={0}>SÃ©lectionnez un type</option>
              {typesDepenses.map((type) => (
                <option key={type.id_type_depense} value={type.id_type_depense}>
                  {type.nom_type}
                </option>
              ))}
            </select>
          </div>

          {/* Montant */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Montant (FCFA) *
            </label>
            <input
              type="number"
              value={formData.montant || ''}
              onChange={(e) => setFormData({ ...formData, montant: parseFloat(e.target.value) || 0 })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="0"
              min="0"
              step="0.01"
              required
            />
          </div>

          {/* Description */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Description
            </label>
            <textarea
              value={formData.description}
              onChange={(e) => setFormData({ ...formData, description: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
              rows={3}
              placeholder="DÃ©tails de la dÃ©pense..."
            />
          </div>

          {/* Actions */}
          <div className="flex gap-3 pt-4">
            <button
              type="button"
              onClick={onClose}
              className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition"
            >
              Annuler
            </button>
            <button
              type="submit"
              disabled={isSubmitting}
              className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isSubmitting ? 'Enregistrement...' : (depense ? 'Modifier' : 'Ajouter')}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
```

---

## ğŸ“„ PAGE PRINCIPALE

```tsx
// app/dashboard/depenses/page.tsx
'use client';

import { useState, useEffect, useMemo } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { DepenseService } from '@/services/depense.service';
import type { DepensesData, Depense, DepenseFormData } from '@/types/depense.types';

import DepensesHeader from '@/components/depenses/DepensesHeader';
import DepensesStatCards from '@/components/depenses/DepensesStatCards';
import DepensesSearchBar from '@/components/depenses/DepensesSearchBar';
import DepensesPagination from '@/components/depenses/DepensesPagination';
import DepensesList from '@/components/depenses/DepensesList';
import AddEditDepenseModal from '@/components/depenses/AddEditDepenseModal';
import DeleteDepenseModal from '@/components/depenses/DeleteDepenseModal';
import GererTypesModal from '@/components/depenses/GererTypesModal';
import { Plus, Settings } from 'lucide-react';

const ITEMS_PER_PAGE = 10;

export default function DepensesPage() {
  const { userData } = useAuth();
  const [data, setData] = useState<DepensesData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  
  // Ã‰tats des modals
  const [isAddEditModalOpen, setIsAddEditModalOpen] = useState(false);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
  const [isTypesModalOpen, setIsTypesModalOpen] = useState(false);
  const [selectedDepense, setSelectedDepense] = useState<Depense | null>(null);
  
  // Ã‰tats de recherche et pagination
  const [searchQuery, setSearchQuery] = useState('');
  const [currentPage, setCurrentPage] = useState(1);
  
  const depenseService = new DepenseService();

  // Charger les donnÃ©es
  useEffect(() => {
    if (userData?.id_structure) {
      chargerDepenses();
    }
  }, [userData]);

  const chargerDepenses = async () => {
    try {
      setLoading(true);
      setError(null);
      
      const result = await depenseService.getListeDepenses(
        userData!.id_structure,
        new Date().getFullYear(),
        'annee'
      );
      
      setData(result);
    } catch (err: any) {
      console.error('Erreur chargement dÃ©penses:', err);
      setError(err.message || 'Impossible de charger les dÃ©penses');
    } finally {
      setLoading(false);
    }
  };

  // Filtrer les dÃ©penses par recherche
  const depensesFiltrees = useMemo(() => {
    if (!data?.liste_depenses) return [];
    
    if (!searchQuery) return data.liste_depenses;
    
    const query = searchQuery.toLowerCase();
    return data.liste_depenses.filter((depense) =>
      depense.nom_type.toLowerCase().includes(query) ||
      depense.description.toLowerCase().includes(query) ||
      depense.montant.toString().includes(query)
    );
  }, [data, searchQuery]);

  // Pagination
  const totalPages = Math.ceil(depensesFiltrees.length / ITEMS_PER_PAGE);
  const depensesPaginees = useMemo(() => {
    const start = (currentPage - 1) * ITEMS_PER_PAGE;
    return depensesFiltrees.slice(start, start + ITEMS_PER_PAGE);
  }, [depensesFiltrees, currentPage]);

  // Handlers
  const handleAjouterDepense = () => {
    setSelectedDepense(null);
    setIsAddEditModalOpen(true);
  };

  const handleEditerDepense = (depense: Depense) => {
    setSelectedDepense(depense);
    setIsAddEditModalOpen(true);
  };

  const handleSupprimerDepense = (depense: Depense) => {
    setSelectedDepense(depense);
    setIsDeleteModalOpen(true);
  };

  const handleSubmitDepense = async (formData: DepenseFormData, depenseId?: number) => {
    try {
      if (depenseId) {
        await depenseService.modifierDepense(userData!.id_structure, depenseId, formData);
      } else {
        await depenseService.ajouterDepense(userData!.id_structure, formData);
      }
      await chargerDepenses();
      setIsAddEditModalOpen(false);
    } catch (error) {
      throw error;
    }
  };

  const handleConfirmDelete = async () => {
    if (!selectedDepense) return;
    
    try {
      await depenseService.supprimerDepense(
        userData!.id_structure,
        selectedDepense.id_depense
      );
      await chargerDepenses();
      setIsDeleteModalOpen(false);
      setSelectedDepense(null);
    } catch (error: any) {
      alert(error.message || 'Erreur lors de la suppression');
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Chargement...</p>
        </div>
      </div>
    );
  }

  if (error || !data) {
    return (
      <div className="p-4">
        <div className="bg-red-50 text-red-600 p-4 rounded-lg">
          {error || 'Erreur de chargement'}
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <DepensesHeader />

      <DepensesStatCards 
        resume={data.resume_depenses}
        typesDepenses={data.depenses_par_type}
      />

      <DepensesSearchBar
        onSearch={setSearchQuery}
        onOpenFilters={() => {/* TODO: ImplÃ©menter filtres */}}
        onRefresh={chargerDepenses}
        isLoading={loading}
      />

      <DepensesPagination
        currentPage={currentPage}
        totalPages={totalPages}
        onPageChange={setCurrentPage}
        totalItems={depensesFiltrees.length}
      />

      <DepensesList
        depenses={depensesPaginees}
        onEdit={handleEditerDepense}
        onDelete={handleSupprimerDepense}
      />

      {/* Boutons d'action flottants */}
      <div className="fixed bottom-6 right-6 flex flex-col gap-3">
        <button
          onClick={() => setIsTypesModalOpen(true)}
          className="bg-gray-600 text-white p-4 rounded-full shadow-lg hover:bg-gray-700 transition"
          title="GÃ©rer les types"
        >
          <Settings size={24} />
        </button>
        <button
          onClick={handleAjouterDepense}
          className="bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition"
          title="Nouvelle dÃ©pense"
        >
          <Plus size={24} />
        </button>
      </div>

      {/* Modals */}
      <AddEditDepenseModal
        isOpen={isAddEditModalOpen}
        onClose={() => setIsAddEditModalOpen(false)}
        onSubmit={handleSubmitDepense}
        depense={selectedDepense}
        typesDepenses={data.depenses_par_type}
      />

      <DeleteDepenseModal
        isOpen={isDeleteModalOpen}
        onClose={() => setIsDeleteModalOpen(false)}
        onConfirm={handleConfirmDelete}
        depense={selectedDepense}
      />

      <GererTypesModal
        isOpen={isTypesModalOpen}
        onClose={() => setIsTypesModalOpen(false)}
        structureId={userData!.id_structure}
        onTypesUpdated={chargerDepenses}
      />
    </div>
  );
}
```

---

## âœ… CHECKLIST DE VALIDATION

Avant de soumettre ton code, vÃ©rifie que :

- [ ] Communication via DatabaseService + XML uniquement
- [ ] Types TypeScript complets et exportÃ©s
- [ ] Gestion d'erreurs robuste (try/catch partout)
- [ ] Loading states affichÃ©s pendant les requÃªtes
- [ ] Modals pour toutes les actions d'Ã©dition/suppression
- [ ] Pagination fonctionnelle (10 items par page)
- [ ] Recherche en temps rÃ©el opÃ©rationnelle
- [ ] Format des montants avec toLocaleString('fr-FR')
- [ ] Validation des formulaires cÃ´tÃ© client
- [ ] Messages de confirmation avant suppression
- [ ] Boutons dÃ©sactivÃ©s pendant les opÃ©rations async
- [ ] Responsive design (mobile-first)
- [ ] Aucun hardcoding de donnÃ©es
- [ ] Code commentÃ© en franÃ§ais
- [ ] Utilisation de extractSingleDataFromResult

---

## ğŸš« INTERDICTIONS ABSOLUES

1. âŒ NE JAMAIS utiliser fetch direct
2. âŒ NE JAMAIS crÃ©er de mock data
3. âŒ NE JAMAIS ignorer les erreurs API
4. âŒ NE JAMAIS hardcoder les IDs
5. âŒ NE JAMAIS oublier les types TypeScript
6. âŒ NE JAMAIS modifier le format XML de requÃªte
7. âŒ NE JAMAIS supprimer sans confirmation
8. âŒ NE JAMAIS oublier la validation des formulaires

---

## ğŸ¯ OBJECTIF FINAL

Un module complet et fonctionnel de gestion des dÃ©penses permettant :
- âœ… Visualiser toutes les dÃ©penses avec statistiques
- âœ… Ajouter de nouvelles dÃ©penses via modal
- âœ… Modifier des dÃ©penses existantes via modal
- âœ… Supprimer des dÃ©penses avec confirmation
- âœ… GÃ©rer les types de dÃ©penses
- âœ… Rechercher et filtrer les dÃ©penses
- âœ… Paginer les rÃ©sultats
- âœ… ExpÃ©rience utilisateur fluide et professionnelle

**Commence par crÃ©er les types TypeScript, puis le service, puis les composants UI, et enfin la page principale. Teste chaque fonctionnalitÃ© au fur et Ã  mesure de l'implÃ©mentation.**